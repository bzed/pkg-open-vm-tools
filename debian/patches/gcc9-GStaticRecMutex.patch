Author: Christian Ehrhardt <christian.ehrhardt@canonical.com>
Original-Author: Oliver Kurth <okurth@vmware.com>
Origin: backport, https://github.com/vmware/open-vm-tools/commit/19ca3e36
X-Backport-Note: only took the GStaticMutex changes from the mcuh bigger rework
Bug-Ubuntu: https://bugs.launchpad.net/bugs/1842301
Applied-Upstream: 11.0
Last-Update: 2019-09-03

--- a/open-vm-tools/libvmtools/vmtoolsLog.c
+++ b/open-vm-tools/libvmtools/vmtoolsLog.c
@@ -155,7 +155,7 @@ static LogHandler *gErrorData;
 static LogHandler *gErrorSyslog;
 static GPtrArray *gDomains = NULL;
 static gboolean gLogInitialized = FALSE;
-static GStaticRecMutex gLogStateMutex = G_STATIC_REC_MUTEX_INIT;
+static GRecMutex gLogStateMutex;
 static gboolean gLoggingStopped = FALSE;
 static gboolean gLogIOSuspended = FALSE;
 
@@ -1046,7 +1046,7 @@ VMTools_ConfigLogToStdio(const gchar *do
 
    if (!gLogInitialized) {
       gLogInitialized = TRUE;
-      g_static_rec_mutex_init(&gLogStateMutex);
+      g_rec_mutex_init(&gLogStateMutex);
    }
 
    gLogEnabled = TRUE;
@@ -1157,7 +1157,7 @@ VMTools_ConfigLogging(const gchar *defau
    gLogEnabled |= force;
    if (!gLogInitialized) {
       gLogInitialized = TRUE;
-      g_static_rec_mutex_init(&gLogStateMutex);
+      g_rec_mutex_init(&gLogStateMutex);
    }
 
    gMaxCacheEntries = g_key_file_get_integer(cfg, LOGGING_GROUP,
@@ -1323,7 +1323,7 @@ VMToolsLogWrapper(GLogLevelFlags level,
 void
 VMTools_AcquireLogStateLock(void)
 {
-   g_static_rec_mutex_lock(&gLogStateMutex);
+   g_rec_mutex_lock(&gLogStateMutex);
 }
 
 
@@ -1334,7 +1334,7 @@ VMTools_AcquireLogStateLock(void)
 void
 VMTools_ReleaseLogStateLock(void)
 {
-   g_static_rec_mutex_unlock(&gLogStateMutex);
+   g_rec_mutex_unlock(&gLogStateMutex);
 }
 
 
